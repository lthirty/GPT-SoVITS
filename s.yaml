edition: 3.0.0
name: hello-world-app
access: default

vars:
  region: cn-hangzhou
  functionName: gpt-sovits-75c0e4
  download_path: /mnt/${vars.functionName}

template:
  SoVITS-Template:
    internetAccess: true
    vpcConfig: auto

flow:
  deploy:
    - run-gpt-sovits, gpt-sovits-api
    - gpt-sovits-service-domain

resources:
  run-gpt-sovits:
    component: fc3
    props:
      region: ${vars.region}
      functionName: ${vars.functionName}
      handler: index.handler
      description: GPT-SoVITS Webui 服务
      timeout: 7200
      runtime: python3.9
      instanceType: c1
      instanceConcurrency: 10
      cpu: 8
      memorySize: 32768
      diskSize: 10240
      environmentVariables:
        TOKENIZERS_PARALLELISM: "false"
        download_path: ${vars.download_path}
      nasConfig: auto
      build:
        command:
          - git clone https://github.com/lthirty/GPT-SoVITS /code/GPT-SoVITS
          - cd /code/GPT-SoVITS
          - pip install -r requirements.txt
        artifact: /code
    extend: SoVITS-Template

  gpt-sovits-api:
    component: fc3
    props:
      region: ${vars.region}
      functionName: ${vars.functionName}__api
      handler: index.handler
      description: GPT-SoVITS API 服务
      timeout: 7200
      runtime: python3.9
      instanceType: c1
      instanceConcurrency: 10
      cpu: 8
      memorySize: 16384
      diskSize: 10240
      environmentVariables:
        is_half: "false"
        TOKENIZERS_PARALLELISM: "false"
        download_path: ${vars.download_path}
      nasConfig: auto
      build:
        command:
          - git clone https://github.com/lthirty/GPT-SoVITS /code/GPT-SoVITS
          - cd /code/GPT-SoVITS
          - pip install -r requirements.txt
        artifact: /code
      triggers:
        - type: http
          config:
            methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
    extend: SoVITS-Template

  gpt-sovits-service-domain:
    component: fc3-domain
    props:
      region: ${vars.region}
      domainName: auto
      protocol: HTTP
      routeConfig:
        routes:
          - path: /*
            functionName: ${vars.functionName}
            qualifier: LATEST
